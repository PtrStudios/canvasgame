<!DOCTYPE html>
<html>
    <canvas id="canvas" width="500" height="500" style="background-color: black;"></canvas>
    <style type="text/css">
        canvas {
            margin: 0 auto;
            display: block;
        }
    </style>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.js"></script>
    <script type="text/javascript">
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");
        var requestAnimationFrame = window.requestAnimationFrame ||
                                    window.webkitRequestAnimationFrame;
        
        // This detects key presses.
        var keys = [];
        window.addEventListener("keydown",function(e) {
            keys[e.keyCode] = true;
        },true);
        window.addEventListener("keyup",function(e) {
            keys[e.keyCode] = false;
        },true);
        
        var enemies = [];
        var totalEnemies = 0;
        
        var won = false;
        // Player object
        var player = {
            x : 50,
            y : 50,
            velX : 0,
            velY : 0,
            width : 50,
            height : 50
        }
		
		//Enemy function constructor
        function enem(x,y,width,height,down) {
            this.x = x;
            this.y = y;
            this.width = width;
            this.height = height;
			this.down = down;
            this.col = function() {
                if (player.x + player.width > this.x && player.x < this.x + this.width && player.y + player.height > this.y && player.y < this.y + this.height) {
					return true;
                }
                else {return false;}
            }
            this.draw = function() {
				ctx.fillStyle = "red";
				ctx.fillRect(this.x,this.y,this.width,this.height);
			}
            this.move = function() {
				this.y += 5;
			}
        }
        
        // Function generates random coordinates for enemies.
		function random(min,max) {
		    return Math.floor(Math.random() * (max - min) + min);
		}
		
		function spawnEnemies(n) {
			for (var i = 0; i < n; i++) {
				enemies[totalEnemies] = new enem(random(100,450),random(-500,-50),50,50,true);
				totalEnemies++;
			}
		}
        
		// Checks if the player's x-coordinate is past the canvas.
		function checkWin() {
			if (player.x > canvas.width - player.width) {
				return true;
				for (var i = 0; i < enemies.length; i++) {
				    delete enemies[i];
				}
			}
			else {
				return false;
			}
		}
		
		setInterval(function() {
		    spawnEnemies(5);
        },2000);
        
		// This code updates the game.
        function update() { 
            ctx.clearRect(0,0,canvas.width,canvas.height);
            if (keys[39] && player.velX < 3) {
                player.velX = 0;
                player.velX+=5;
            }
            if (keys[37] && player.velX < 3) {
                player.velX = 0;
                player.velX-=5;
            }
            if (keys[38] && player.velX < 3) {
                player.velY = 0;
                player.velY-=5;
            }
            if (keys[40] && player.velX < 3) {
                player.velY = 0;
                player.velY+=5;
            }
            player.velX *= 0.9;
            player.velY *= 0.9;
            ctx.fillStyle = "white";
            if (!checkWin()) {
                player.x += player.velX;
                player.y += player.velY;
            }
			if (checkWin()) {
				$("p").html("YOU WIN");
				win = true;
			}
            ctx.fillRect(player.x,player.y,player.width,player.height);
            ctx.fillStyle = "red";
            for (var i = 0; i < enemies.length; i++) {
                enemies[i].draw();
                if (!enemies[i].col()) {
                    enemies[i].move();
                }
                else {
                    ("p").html("YOU LOSE"); 
                }
            }
            requestAnimationFrame(update);
        }
		update();
    </script>
    <br>
    <p></p>
</html>